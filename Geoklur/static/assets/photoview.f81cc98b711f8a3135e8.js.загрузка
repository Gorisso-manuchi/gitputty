(self.webpackChunkvk=self.webpackChunkvk||[]).push([[7549],{59604:function(e,t,n){"use strict";var r,o=n(79573),i=n(71437),s=n(20848),a=n(38869),u=n(53006),l=n(20594),c=n(23634),d=n(62641),_=n(72864),v=n(80580),p=n(49598),f=n(63918),h=n(39871),g=n(24661),m=n(44167),k=!1;window.onDOMReady((function(){k=!0}));var w={destroyFns:[],init:function(){var e,t=this,n=(0,i.$)(".PhotoviewPage");if(!n)return!1;console.log("init photoview");var o=n.querySelector(".pv_tag_wrap"),s=n.querySelector(".PhotoviewPage__thumb"),a=s.querySelector(".pv_nav"),u=n.querySelector(".PhotoviewPage__photo"),l=(0,i.$)(".PhotoviewPage__photo img",s),c=n.querySelector(".pv_footer"),d=n.classList.contains("pv_touch_full");return r={pageEl:n,photoEl:u,photoImageEl:l,tags:o,thumb:s,footer:c,canOpenLayer:d},a&&this.attachNavigationButtons(a),null===(e=window.cur.destroy)||void 0===e||e.push((function(){return t.destroy()})),this.subscribeEvents(),!0},destroy:function(){console.log("destroy photoview"),this.unsubscribeEvents(),this.destroyFns.forEach((function(e){return e()})),this.destroyFns=[],r=void 0},subscribeEvents:function(){var e=this;window.addEventListener("keydown",this.onKeyDown),window.addEventListener("resize",this.onResize),a.default.onClear(this.onResize),this.destroyFns.push(g.$isOpen.watch((function(t){return e.toggleVisibility(t)})).unsubscribe)},toggleVisibility:function(e){r&&r.pageEl&&(0,s.setStyle)(r.pageEl,"display",e?"none":"block")},unsubscribeEvents:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("resize",this.onResize),a.default.onClear.off(this.onResize)},updateUI:function(e,t,n){var _,p,f,h,g,k;if(!(r&&r.photoEl&&r.photoImageEl&&r.pageEl&&e))return!1;var b=r.pageEl.getAttribute("data-id")!==e.id,$=e.photo;if(r.photoImageEl&&r.photoImageEl.src!=$){r.photoImageEl.onload=null,r.photoImageEl.remove();var E=(0,v.html)((0,u._PhotoviewPage_tags)(e.tags));(0,s.val)(r.photoEl,'<img src="'+($||"/images/blank.gif")+'" alt="" class="ph_img" />'+E),r.photoImageEl=(0,s.geByTag1)("img",r.photoEl)}if(r.canOpenLayer){var P=t?"/"+t+(n?"/rev":""):"",I="photo"+e.id+P,y=(0,d.makeUrl)("/photo"+e.id,{z:I,list:t});r.currentButtonLink&&(r.currentButtonLink.href=y),window.ajax.prepare_click(r.currentButtonLink),null===(_=r.currentButtonLink)||void 0===_||_.setAttribute("onclick","return photo.openInLayer(null, event, '"+e.id+"', '"+t+"');")}var L=(0,i.$)(".Replies");L&&(e.replies_html?((0,s.show)(L),L.outerHTML=e.replies_html):(0,s.hide)(L));var x=(0,i.$)(".RepliesField"),S=l.default.getStickerPanel();b&&x&&e.reply_field_html&&S&&(x.outerHTML=e.reply_field_html.replace("\x3c!--stickers_panel--\x3e",S));var T=null===(p=r.pageEl)||void 0===p?void 0:p.childNodes[0];T&&T.setAttribute("id","photo"+e.id);var O,D=(0,i.$)(".PhotoviewPage__restrictedInfo"),R="block"===(null===(f=e.restriction)||void 0===f?void 0:f.type)||"blur"===(null===(h=e.restriction)||void 0===h?void 0:h.type)&&!a.default.isCleared("photo"+e.id,String(null===(g=e.restriction)||void 0===g?void 0:g.restrictionId));R&&(O=(0,o.__assign)((0,o.__assign)({},e.restriction),{forceText:!0,raw:"photo"+e.id,width:(0,s.getW)(r.photoEl),height:(0,s.getH)(r.pageEl)}),!r.photoImageEl||r.photoImageEl.complete||r.photoImageEl.onload||(r.photoImageEl.onload=w.onResize)),r.pageEl.classList.toggle("pv_touch--hideZOpen",R),(0,s.toggle)(D,R),r.photoEl.classList.toggle("PhotoviewPage__photo--block",!(!O||"block"!==O.type)),r.photoEl.classList.toggle("PhotoviewPage__photo--blur",!(!O||"blur"!==O.type)),R&&D&&(D.innerHTML=(0,v.html)((0,a.default)(O)));var C=(0,i.$)(".wi_like_wrap",r.pageEl);C&&(C.innerHTML=e.liked_people||"",C.classList.toggle("is_empty",!e.liked_people));var F=(0,i.$)(".wi_buttons",r.pageEl);(0,s.val)(F,e.like_buttons||"");var A=(0,i.$)(".AlbumInfoRow",r.pageEl);A&&(A.outerHTML=(0,v.html)((0,c.default)({url:e.album_href,author_url:e.author_href,avatar:e.avatar,id:e.owner_id,name:e.owner_name,title:(0,v.wrap)(e.album_title),subtitle:(0,v.wrap)(e.album_info_subtitle),withoutBottomBorder:!e.has_replies})));var M=(0,i.$)(".PhotoviewPage__description",r.pageEl);if(M){var U=e.full_description||e.description;M.innerHTML=U||"",M.classList.toggle("PhotoviewPage__description--empty",!U)}var j=(0,i.$)(".PhotoviewPage__caption",r.pageEl);if(j){var B="";e.caption&&(B+=e.caption),(0,s.val)(j,B)}var H=(0,i.$)("#mhead .HeaderSubtitle__subtitle");if(H){var V=m.$index.getState(),q=m.$count.getState();H.innerHTML=(0,s.getLang)("mobile_photos_photo_header").replace("%s",V+1).replace(/%s|{count}/,q)}var z=(0,i.$)("#photo_actions");if(z&&(z.innerHTML=(0,v.render)(e.actions)),r.pageEl.setAttribute("data-id",e.id),M&&!e.full_description){var N=(0,i.$)(".pi_text_more",M),Z=!!(null===(k=window.nav.getQuery())||void 0===k?void 0:k.description_expanded);M.removeEventListener("click",w.onTextExpanded),N&&(Z?(N.click(),w.onTextExpanded()):M.addEventListener("click",w.onTextExpanded,{passive:!0}))}return window.post.stickersInit(),window.cur.replyTo=0,window.ajax.refreshLinks(e.fv_link,e.app_link),setTimeout((function(){var t=(0,d.getState)("autoload")||{};window.Replies.init(t.enable||!1,e.author_id||e.owner_id)})),!0},updateURL:function(e,t,n){var r=(0,o.__assign)((0,o.__assign)({},window.nav.getQuery()),{list:t,rev:n?1:null});delete r.description_expanded;var a=(0,d.makeUrl)("/photo"+e.id,r);window.nav.go(a,null,{push_only:!0,replace:!0}),window.page.save(a,{st:(0,s.scrollTop)(),page:(0,i.$)("#m"),state:window.page.stash(),cur:window.cur,options:{replacePrevPage:!0}},!1)},render:function(){w.updateUI(m.$currentItem.getState(),m.$list_id.getState(),m.$reverse_order_enabled.getState())},onResize:function(){r&&r.photoEl&&document.body.contains(r.photoEl)&&(document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName)||(0,s.isVisible)((0,i.$)("#stickers_panel"))||w.render())},onTextExpanded:function(){var e,t=m.$currentItem.getState(),n=r&&(0,i.$)(".PhotoviewPage__description",r.pageEl);t&&n&&(0,m.setFullDescription)(((e={})[t.id]=n.innerHTML,e))},onKeyDown:function(e){switch(e.which){case 37:return e.preventDefault(),w.prev(e);case 39:return e.preventDefault(),w.next(e)}},next:function(e){return!!(0,s.checkEvent)(e)||(m.$nextItem.getState()&&(0,m.addIndex)(1),!1)},prev:function(e){return!!(0,s.checkEvent)(e)||(m.$prevItem.getState()&&(0,m.addIndex)(-1),!1)},showControls:function(){setTimeout((function(){r&&(null==r?void 0:r.pageEl)&&(r.pageEl.classList.remove("pv_hidden_icons"),setTimeout((function(){r&&(null==r?void 0:r.pageEl)&&r.pageEl.classList.add("pv_icons_hide")}),2e3))}),100)},fullscreen:function(e,t){var n;return!!(null===(n=null==r?void 0:r.thumb)||void 0===n?void 0:n.classList.contains("pv_photo_tags_selected"))||window.nav.go(t,e,{need_restore:!0})},onTagClick:function(e,t,n){if(!r||!r.thumb)return!0;if(n&&!r.thumb.classList.contains("pv_photo_tags_selected"))return!0;var o=(0,i.$)("#pv_tag"+t),a=(0,i.$)("#pv_tag_label"+t),u=(0,i.$)(".pv_tag_label_selected",(0,i.$)(".pv_tags_list"));return o&&o.classList.contains("pv_tag_selected")||null==o||o.classList.remove("pv_tag_selected"),a.classList.contains("pv_tag_label_selected")?window.nav.go(a,e):(u&&u.classList.remove("pv_tag_label_selected"),a.classList.add("pv_tag_label_selected"),r.thumb.classList.add("pv_photo_tags_selected"),(0,s.cancelEvent)(e),!1)},onDeleteClick:function(e,t){if(t){var n=(0,i.$)(".Popup_open");n&&(0,p.closePopup)(n),e.preventDefault(),e.stopPropagation();var r=(0,f.default)({title:(0,s.getLang)("mobile_photos_delete_confirm_title"),text:(0,s.getLang)("mobile_photos_delete_confirm_text"),buttons:{yes:{text:(0,s.getLang)("mobile_delete"),href:t,onClick:"return ajax.click(this, PhotoDelete)"},no:{text:(0,s.getLang)("mobile_cancel")}}}),o=(0,h.elem)(r);return(0,p.openPopup)(o,!0)}},attachNavigationButtons:function(e){var t=e.querySelector(".pv_nav_left"),n=e.querySelector(".pv_nav_z"),o=e.querySelector(".pv_nav_right"),i=null==t?void 0:t.querySelector(".pv_nav_link"),s=null==n?void 0:n.querySelector(".pv_nav_link"),a=null==o?void 0:o.querySelector(".pv_nav_link");r&&(r.leftButtonLink=i,r.currentButtonLink=s,r.rightButtonLink=a),i.setAttribute("onclick","return PhotoviewPage.prev(event);"),s.setAttribute("onclick","return PhotoviewPage.next(event);"),a.setAttribute("onclick","return PhotoviewPage.next(event);"),window.ajax.prepare_click([i,s,a])}},b=0;(0,_.combine)(m.$currentItem,m.$list_id,m.$reverse_order_enabled).watch((function(e){var t=(0,o.__read)(e,3),n=t[0],r=t[1],i=t[2],s=++b;function a(){s===b&&(w.updateUI(n,r,i)&&w.updateURL(n,r,i))}w&&(k?a():window.onDOMReady((function(){return a()})))})),window.page.onChanged((function(){setTimeout((function(){w.init()}))}));var $=n(16144),E=n(69161),P=n(64712);$.requestBlurRemoveFx.use((function(e){var t=e.photo;return new Promise((function(e){var n=t.restriction;if(!n)return e(!1);window.PostPhotoRestriction.clear(null,null,n.text,n.button,"photo"+t.id,n.hash).then((function(n){var r=n.result,o=n.isFullyAvailable,i=n.unblurTypes;e(r),o?(0,$.removeBlurRestrictions)(i):r&&(0,$.removeRestrictionById)(t.id)}))}))})),$.$photos.on(P.fetchPhotosFx.done,(function(e,t){var n=t.result[0];return Object.values(n).forEach((function(t){e[t.id]=t})),(0,o.__assign)({},e)})),(0,_.sample)({source:[m.$count,m.$index,m.$currentPhotos],clock:m.addIndex,fn:function(e,t){var n=(0,o.__read)(e,3),r=n[0],i=n[1],s=n[2],a=(0,E.getCircularIndex)(i+t,r);return s[a]?a:i},target:m.setIndex}),(0,_.sample)({clock:P.showPhoto,source:m.$currentList,fn:function(e,t){return e.indexOf(t)},target:m.setIndex}),(0,_.guard)({clock:m.setIndex,filter:function(e){return-1!==e},target:m.$index}),$.$photos.on($.removeBlurRestrictions,(function(e,t){return Object.entries(e).reduce((function(e,n){var r,i,s=(0,o.__read)(n,2),a=s[0],u=s[1];return"blur"===(null===(r=u.restriction)||void 0===r?void 0:r.type)&&t.includes(null===(i=u.restriction)||void 0===i?void 0:i.restrictionId)&&delete u.restriction,e[a]=u,e}),{})})),$.$photos.on($.removeRestrictionById,(function(e,t){return Object.entries(e).reduce((function(e,n){var r,i=(0,o.__read)(n,2),s=i[0],a=i[1];return a.id===t&&"blur"===(null===(r=a.restriction)||void 0===r?void 0:r.type)&&delete a.restriction,e[s]=a,e}),{})})),$.$photos.on($.insertPhotos,(function(e,t){return(0,o.__assign)((0,o.__assign)({},e),t.reduce((function(t,n){var r;return(0,o.__assign)((0,o.__assign)({},t),((r={})[n.id]=e[n.id]||n,r))}),{}))})),$.$photos.on($.upsertPhoto,(function(e,t){var n;return(0,o.__assign)((0,o.__assign)({},e),((n={})[t.id]=t,n))})),$.$photos.on($.upsertPhotos,(function(e,t){return(0,o.__assign)((0,o.__assign)({},e),t.reduce((function(e,t){var n;return(0,o.__assign)((0,o.__assign)({},e),((n={})[t.id]=t,n))}),{}))}));var I,y=n(15247),L=n(79957),x=n(12449),S=n(79764);var T,O,D,R,C=(T=(0,_.createStore)(new Set),O=(0,_.createEffect)(),D=(0,_.createEvent)(),R=(0,_.guard)({clock:(0,_.sample)(T,D,(function(e,t){return e.has(t.key)?null:t})),filter:function(e){return null!==e},target:O}),T.on(R,(function(e,t){return e.add(t.key),e})),T.on(O.finally,(function(e,t){return e.delete(t.params.key),e})),(I={fx:O,event:D}).fx),F=I.event;C.use((function(e){var t=e.key,n=e.state,r=e.hash;return new Promise((function(e,o){var i=(0,y.makeUrl)("/like",{act:n?"add":"del",object:"photo"+t,hash:r,_ajax:1,mediaview:1});(0,L.statlogsValueEvent)(x.STATLOG_MEDIAVIEW_EVENT,"action","like"),S.default.post(i,{},{ignoreAbort:!1,onDone:function(n){e({key:t,count:n.likes,state:n.is_liked,buttons:n.like_buttons,people:n.like_people})},onFail:function(){return o(),!0}})}))})),$.$photos.on(C,(function(e,t){var n=e[t.key];return e[t.key]?(n.likes_cnt=n.likes_cnt||0,n.likes_cnt=Math.max(0,n.likes_cnt+(t.state?1:-1)),n.likes_me=t.state,e[t.key]=n,(0,o.__assign)({},e)):e})),$.$photos.on(C.finally,(function(e,t){var n=e[t.params.key];return void 0===(null==n?void 0:n.likes_cnt)?e:("done"===t.status?(n.likes_cnt=t.result.count,n.likes_me=t.result.state,n.liked_people=t.result.people,n.like_buttons=t.result.buttons):(n.likes_me=!1,n.likes_cnt=Math.max(0,n.likes_cnt-1)),e[t.params.key]=n,(0,o.__assign)({},e))}));var A=n(11397);P.fetchPhotosFx.use((function(e){var t=e.url,n={_ajax:1,offset:e.offset,direction:e.direction,rev:e.rev?1:0};return l.default.getStickerPanel()||(n.need_stickers=1),S.default.post(t,n).promise.then((function(e){return e.json.location?[[],0]:e.json.data}))})),(0,_.sample)({source:[P.$lists,m.$list_id],clock:P.fetchPhotosFx.done,fn:function(e,t){var n,r=(0,o.__read)(e,2),i=r[0],s=r[1],a=t.result,u=(0,o.__spreadArray)([],(0,o.__read)(i[s]),!1),l=a[0];return Object.keys(l).forEach((function(e){u[+e]=l[+e].id})),(0,o.__assign)((0,o.__assign)({},i),((n={})[s]=u,n))},target:P.$lists}),P.$counts.on(P.fetchPhotosFx.done,(function(e,t){var n,r=t.result,i=t.params;return(0,o.__assign)((0,o.__assign)({},e),((n={})[i.list_id]=r[1]||0,n))})).on(P.invalidateList,(function(e,t){var n,r=t.list_id;return(0,o.__assign)((0,o.__assign)({},e),((n={})[r]=0,n))})).on(P.setListCount,(function(e,t){var n;return(0,o.__assign)((0,o.__assign)({},e),((n={})[t.list_id]=t.count,n))})),P.$lists.on(P.setListItems,(function(e,t){var n;return(0,o.__assign)((0,o.__assign)({},e),((n={})[t.list_id]=(0,A.transformIndexObject)(t.items),n))})).on(P.invalidateList,(function(e,t){var n,r=t.list_id;return(0,o.__assign)((0,o.__assign)({},e),((n={})[r]=[],n))})).on(P.insertListItems,(function(e,t){var n,r=e[t.list_id]?(0,o.__spreadArray)([],(0,o.__read)(e[t.list_id]),!1):[];return Object.keys(t.items).forEach((function(e){r[+e]||(r[+e]=t.items[e])})),(0,o.__assign)((0,o.__assign)({},e),((n={})[t.list_id]=r,n))})).on(P.fetchPhotosFx.done,(function(e,t){var n=t.result,r=t.params,i=(0,o.__assign)({},e);return i[r.list_id]||(i[r.list_id]=[]),Object.keys(n[0]).forEach((function(e){i[r.list_id][+e]=n[0][e].id})),i}));var M=(0,_.combine)(m.$currentPhotos,m.$index,m.$list_id,m.$count,m.$reverse_order_enabled,m.$targetPhotoID,m.$community_param,(function(e,t,n,r,o,i,s){var a=0,u=-1,l=e[t];if(!n||!l)return i&&n?{url:(0,y.makeUrl)("/photo"+i,{list:n,community:s}),offset:0,direction:1,rev:o,list_id:n}:{url:"",offset:u,direction:a,rev:o,list_id:""};for(var c=0;c<5;c++){var d=t+c;if((!(_=e[t+c])||_.need_reload)&&d<r){a=1,u=t+c;break}}if(-1===u)for(c=0;c<3;c++){var _,v=t-c;if((!(_=e[t-c])||_.need_reload)&&v>=0){a=-1,u=t-c;break}}var p=l.id?"/photo"+l.id:"/photos.php";return{url:(0,y.makeUrl)(p,{hash:l.hash,oid:l.id?null:l.owner_id,list:n,community:s}),offset:u,direction:a,rev:o,list_id:n}})),U=(0,_.combine)(P.fetchPhotosFx.pending.map((function(e){return!e})),(0,_.combine)(m.$list_id,m.$targetPhotoID,m.$currentItem).map((function(e){return e.some((function(e){return!!e}))}))).map((function(e){return e.every((function(e){return e}))})),j=(0,_.combine)(U,M.map((function(e){return-1!==e.offset}))).map((function(e){return e.every((function(e){return e}))}));(0,_.guard)({clock:(0,_.sample)({clock:P.loadItems,source:M,fn:function(e,t){var n=t.offset;return(0,o.__assign)((0,o.__assign)({},e),{offset:n})}}),filter:U,target:P.fetchPhotosFx}),(0,_.guard)({source:M,filter:j,target:P.fetchPhotosFx});var B=n(97170);m.$fullDescriptions.on(m.setFullDescription,(function(e,t){return(0,o.__assign)((0,o.__assign)({},e),t)})),(0,_.sample)({source:[m.$currentItem,m.$index,m.$targetPhotoID],clock:P.fetchPhotosFx.doneData,fn:function(e,t){var n=(0,o.__read)(e,3),r=n[0],i=n[1],s=n[2],a=Number(Object.keys(t[0]).find((function(e){return t[0][e].id===s})));if(a)return a;var u=Number(Object.keys(t[0]).find((function(e){return t[0][e].id===(null==r?void 0:r.id)})));return u||i},target:[m.setIndex,m.resetTargetPhotoId]});var H="PHOTO_VIEW_DATA";(0,_.combine)(m.$list_id,m.$index,m.$reverse_order_enabled,(function(e,t,n){window.cur[H]=(0,o.__assign)((0,o.__assign)({},window.cur[H]||{}),{list_id:e,index:t,rev:n})})),m.$targetPhotoID.reset(m.setListId,m.setReverseOrder,m.resetTargetPhotoId),B.default.onChange((function(){var e=window.cur[H];e&&((0,m.setListId)(e.list_id),(0,m.setIndex)(e.index),(0,m.setReverseOrder)(e.rev))}));var V=n(89414),q=n(82442),z=n(41313),N=n(84316),Z=n(12315);(0,_.sample)({source:m.$currentItem,clock:g.openActionMenu}).watch((function(e){(null==e?void 0:e.actions)&&V.ContextMenu.open((0,q.elem)(e.actions),null,{pureMenu:!0})})),(0,_.sample)({source:[m.$currentItem,m.$list_id,m.$reverse_order_enabled],clock:g.openReplies}).watch((function(e){var t=(0,o.__read)(e,3),n=t[0],r=t[1],i=t[2];if(console.log("reverse order: ",i),n){var s=(0,y.makeUrl)("/photo"+n.id,{list:r,rev:i?1:0})+"#comments";return window.nav.go(s,null,{alMode:"photo"})}})),(0,_.forward)({from:(0,_.sample)({source:m.$currentItem,clock:g.likeMediaViewPhoto,fn:function(e,t){return{state:t.state,key:t.id,hash:null==e?void 0:e.like_hash}}}),to:F}),(0,_.sample)({source:[$.$photos,m.$list_id],clock:g.shareMediaViewPhoto,fn:z.predicateSampleSource}).watch((function(e){var t=(0,o.__read)(e,2),n=(0,o.__read)(t[0],2),r=n[0],i=n[1],s=t[1],a=r[s.id];a&&window.Share(s.id,{mail_hash:a.mail_hash,object:"photo"+a.id,list:i||"",can_bookmark:!1,can_to_own:!0,can_to_club:!0})}));var W=(0,_.split)(g.openTag,{user:function(e){return!e.startsWith("market")},market:function(e){return e.startsWith("market")}});(0,_.sample)({source:m.$currentItem,clock:W.user,fn:function(e,t){return[e,t]}}).watch((function(e){var t=(0,o.__read)(e,2),n=t[0],r=t[1],i=null==n?void 0:n.tags[r];i&&i[2]&&window.nav.go(i[2])})),(0,_.sample)({source:m.$currentItem,clock:W.market,fn:function(e,t){return[e,t]}}).watch((function(e){var t=(0,o.__read)(e,2),n=t[0],r=t[1],i=parseInt(r.split("market_")[1]),s=null==n?void 0:n.market_tags.tags[i];s.url&&window.nav.go(s.url)}));var G=(0,_.split)(g.toggleLayer,{onOpen:function(e){return e.state},onClose:function(e){return!e.state}}).onClose;(0,_.forward)({from:[G.map((function(e){return{is_back_navigation:!1===e.state&&e.isBackNavigation,keepZUrl:!1===e.state&&e.keepZUrl}}))],to:g.setZUrl}),(0,_.forward)({from:(0,_.sample)({clock:(0,_.guard)({source:[g.$isOpen,m.$currentItem,m.$list_id],filter:function(e){return(0,o.__read)(e,1)[0]}})}).map((function(e){var t=(0,o.__read)(e,3),n=(t[0],t[1]),r=t[2];return n?{id:n.id,list_id:r}:null})),to:g.setZUrl}),(0,_.sample)({source:m.$reverse_order_enabled,clock:g.setZUrl,fn:z.predicateSampleSource}).watch((function(e){var t=(0,o.__read)(e,2),n=t[0],r=t[1],i=(0,y.parseURL)(location.href).search,a=(0,s.qs2obj)(i.replace("?","")),u=r&&r.id&&r.list_id,l=!u,c=r&&r.is_back_navigation,d=x.Z_PHOTO_REGEX.test(a.z),_=void 0;if(u&&r){var v=r.id,p=r.list_id,f=$.$photos.getState()[v+""];f&&(_="photo"+f.id+"/"+p+(n?"/rev":""))}else d&&(null==r?void 0:r.keepZUrl)&&(_=a.z);if(l)if(d&&c&&!(null==r?void 0:r.keepZUrl)){if(Z.default.tryHistoryBack())return}else if(!d)return;window.nav.go((0,y.makeUrl)(window.nav.cur,{z:_}),null,{nav_init:u,nav_set:!!u&&1,replace:d,push_only:!0})})),(0,_.sample)({source:m.$currentItem,clock:g.onActionClick,fn:z.predicateSampleSource}).watch((function(e){var t,n,r=(0,o.__read)(e,1)[0];(null===(n=null===(t=null==r?void 0:r.market_tags)||void 0===t?void 0:t.tags)||void 0===n?void 0:n.length)&&((0,s.statlogsValueEvent)(x.STATLOG_MEDIAVIEW_EVENT,"action","market"),(0,N._openItemsPopup)(escape(JSON.stringify(r.market_tags.tags))))})),g.$isOpen.on(g.toggleLayer,(function(e,t){return t.state})).on(P.invalidateList,(function(){return!1}));var K=(0,z.createServerStore)("PHOTOS/PHOTOVIEW_PAGE",null);K.watch((function(e){return e&&w.init()})),(0,z.createStoreStateMapper)(K,{lists:P.setListItems,count:P.setListCount,photos:$.upsertPhotos,list_id:m.setListId,rev:m.setReverseOrder,from:m.setFromParam,community:m.setCommunityParam,initial_photo_id:P.showPhoto}),window.PhotoviewPage=w},64712:function(e,t,n){"use strict";n.d(t,{fetchPhotosFx:function(){return o},$lists:function(){return i},$counts:function(){return s},showPhoto:function(){return a},setListItems:function(){return u},insertListItems:function(){return l},setListCount:function(){return c},invalidateList:function(){return d},loadItems:function(){return _}});var r=(0,n(72864).createDomain)("PHOTO/LISTS"),o=r.createEffect(),i=r.createStore({},{name:"lists"}),s=r.createStore({},{name:"counts"}),a=(r.createEvent("preloadItems"),r.createEvent("showPhoto")),u=r.createEvent("setListItems"),l=r.createEvent("insertListItems"),c=r.createEvent("setListCount"),d=r.createEvent("invalidateList"),_=r.createEvent("loadItems")},44167:function(e,t,n){"use strict";n.d(t,{$community_param:function(){return b},$count:function(){return y},$currentItem:function(){return x},$currentList:function(){return P},$currentPhotos:function(){return I},$fullDescriptions:function(){return m},$index:function(){return k},$list_id:function(){return w},$nextItem:function(){return S},$prevItem:function(){return L},$reverse_order_enabled:function(){return $},$targetPhotoID:function(){return E},addIndex:function(){return _},resetTargetPhotoId:function(){return g},setCommunityParam:function(){return d},setFromParam:function(){return c},setFullDescription:function(){return f},setIndex:function(){return l},setListId:function(){return v},setReverseOrder:function(){return p},setTargetPhotoID:function(){return h}});var r=n(79573),o=n(72864),i=n(16144),s=n(64712),a=n(69161),u=(0,o.createDomain)("PHOTO/VIEW"),l=u.createEvent("setIndex"),c=u.createEvent("setFromParam"),d=u.createEvent("setCommunityParam"),_=u.createEvent("addIndex"),v=u.createEvent("setListId"),p=u.createEvent("setReverseOrder"),f=u.createEvent("setFullDescriptions"),h=u.createEvent("setTargetPhotoID"),g=u.createEvent("resetTargetPhotoId"),m=u.createStore({},{name:"fullDescriptions"}),k=u.createStore(0,{name:"index"}),w=(0,o.restore)(v,""),b=((0,o.restore)(c,""),(0,o.restore)(d,null)),$=(0,o.restore)(p,!1),E=(0,o.restore)(h,null),P=(0,o.combine)(w,s.$lists,(function(e,t){return t[e]||[]})),I=(0,o.combine)(P,i.$photos,(function(e,t){return e.map((function(e){return t[e]}))})),y=(0,o.combine)(w,s.$counts,(function(e,t){return t[e]||0})),L=(0,o.combine)([P,i.$photos,k,y,m],(function(e){var t=(0,r.__read)(e,5),n=t[0],o=t[1],i=t[2],s=t[3],u=t[4],l=o[n[(0,a.getCircularIndex)(i-1,s)]];if(l)return(0,r.__assign)((0,r.__assign)({},l),{full_description:u[l.id]})})),x=(0,o.combine)([P,i.$photos,k,m],(function(e){var t=(0,r.__read)(e,4),n=t[0],o=t[1],i=t[2],s=t[3],a=o[n[i]];if(a)return(0,r.__assign)((0,r.__assign)({},a),{full_description:s[a.id]})})),S=(0,o.combine)([P,i.$photos,k,y,m],(function(e){var t=(0,r.__read)(e,5),n=t[0],o=t[1],i=t[2],s=t[3],u=t[4],l=o[n[(0,a.getCircularIndex)(i+1,s)]];if(l)return(0,r.__assign)((0,r.__assign)({},l),{full_description:u[l.id]})}))}},function(e){"use strict";e.O(0,[4578,1777,4736,5456,5790,3898,5411,6855,6199,490,410,6444,8592,7219,6429],(function(){return t=59604,e(e.s=t);var t}));e.O()}]);